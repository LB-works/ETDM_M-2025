## EmailJS Setup Instructions

### Step 1: Install EmailJS Package
Run this command in the react-dashboard folder:
```bash
npm install @emailjs/browser
```

### Step 2: Configure EmailJS Credentials

1. **Get Service ID:**
   - Go to EmailJS Dashboard → Email Services
   - Copy your Service ID (e.g., `service_abc123`)

2. **Get Template ID:**
   - Go to EmailJS Dashboard → Email Templates
   - Find the bypass alert template you created
   - Copy the Template ID (e.g., `template_xyz789`)

3. **Get Public Key:**
   - Go to EmailJS Dashboard → Account → API Keys
   - Copy your Public Key (looks like a long string)

4. **Update .env file:**
   - Open `react-dashboard/.env`
   - Replace the placeholder values:
   ```
   VITE_EMAILJS_SERVICE_ID=service_abc123
   VITE_EMAILJS_TEMPLATE_ID=template_xyz789
   VITE_EMAILJS_PUBLIC_KEY=your_actual_public_key
   VITE_ADMIN_EMAIL=youradmin@email.com
   VITE_ADMIN_NAME=Your Name
   ```

### Step 3: Restart Development Server

After updating `.env`, restart your React development server:
```bash
npm run dev
```

### Step 4: Test the Email Alerts

1. Trigger a bypass event (Client current low, Pole current high)
2. Check your browser console for email sending logs
3. Check your admin email inbox
4. Verify 60-minute throttle (subsequent bypasses won't send emails for 60 mins)

### How It Works:

1. **Real-time Monitoring:**
   - FleetOverview component monitors Firebase for bypass alerts
   - When `theft_detected` becomes `true`, email is triggered

2. **60-Minute Throttle:**
   - Each meter has a separate 60-minute cooldown
   - Only one email per meter per hour
   - Prevents email spam during extended bypass events

3. **Email Recipients:**
   - **Admin:** Always receives all bypass alerts
   - **Customer:** Receives alerts for their specific meter (if email configured)

4. **Email Contains:**
   - Meter ID and Pair ID
   - Detection timestamp
   - Client vs Pole current readings
   - Current ratio
   - Bypassed energy (kWh)
   - Estimated financial loss (₦)
   - Direct link to dashboard

### Adding Customer Emails (Optional):

To send emails to specific customers, add email fields to Firebase:

```
meters/PAIR_001/
  ├─ customer_email: "customer@example.com"
  ├─ customer_name: "John Doe"
  └─ client/
      └─ live_data/...
```

The system will automatically send to both admin and customer when bypass is detected.

### Troubleshooting:

**Emails not sending?**
- Check browser console for errors
- Verify EmailJS credentials in `.env`
- Make sure dashboard is running (needs to be open to send emails)
- Check EmailJS dashboard for quota limits (200 emails/month free)

**Too many emails?**
- 60-minute throttle should prevent spam
- Check console logs for "Email throttled" messages

**Need to test without waiting 60 minutes?**
- Restart the dashboard (clears throttle memory)
- Or change `THROTTLE_DURATION` in `emailService.js`

### EmailJS Free Tier Limits:
- 200 emails per month
- Unlimited templates
- No credit card required
- Perfect for monitoring 10-20 meters
